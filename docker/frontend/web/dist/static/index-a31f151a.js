import{v as ve,t as ge,w as we,x as be,q as he}from"./index-46bdc1ae.js";import{x as ye,r as Ce,z as De,C as ke,A as Se,B as Ve,E as R,D as xe}from"./element-0afb0e99.js";import{p as Ie,r as f,aE as Ne,Z as ze,ai as s,aq as Re,q as d,t as q,P as j,M as g,O as t,v as h,U as e,F as $,a8 as F,u as m,S as i,I as Te,T as y,R as H}from"./vue-956193f0.js";import{v as Le,b as Ue,a as W,c as Be}from"./level-61112490.js";import{e as Ae,f as qe,_ as Ee}from"./index-35ab6744.js";import{H as Q,p as Me,W as Z,a as Oe,b as Pe}from"./level.css_vue_type_style_index_0_src_true_lang-509bbc79.js";import"./vxe-78a23074.js";const je={class:"app-container"},$e={class:"toolbar-wrapper"},Fe={class:"table-wrapper"},He={class:"demo-pagination-block"},We=Ie({__name:"index",setup(Qe){const C=f(!1),J=Ne(),K=f(!1),V=f(),T=f(10),L=f(1),U=f(0),N=f(0),w={pageSize:20,pageNum:1},c=ze({agentId:"",level:0}),D=()=>{C.value=!0,ve(w).then(l=>{const{pageSize:n,pageNum:r,total:o,pages:p,list:u}=l.data;V.value=u,T.value=n,U.value=p,L.value=r,N.value=o}).catch(()=>{V.value=[]}).finally(()=>{C.value=!1})};function G(){ge().then(l=>{A.value=l.data})}function k(l){const n=JSON.parse(l),r=n.vulnerableType;if(r==Q)return Me(n)[0];if(r==Z)return Oe(n)[0];{const o=n.flowData,p=Pe(o),u=p.length;return p[u-1]}}function B(l){return l==Q?2:l==Z?3:1}const E=f(),A=f();function X(l){E.value=l}function M(l){Ve.confirm("确定删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{C.value=!0,we(l).then(()=>{R({type:"success",message:"删除成功"}),D()}).finally(()=>{C.value=!1})}).catch(()=>{R({type:"info",message:"删除出错"})})}function Y(){const l=[];for(const n of E.value)l.push(n.id);M(l.join(","))}function ee(){const l="/api/v1/report/export",n=Ae();qe({method:"get",baseURL:l,data:{},headers:{Authorization:n?`Bearer ${n}`:void 0},responseType:"blob"}).then(r=>{const o=r.data;if(!o)return;const p=window.URL.createObjectURL(new Blob([o])),u=document.createElement("a");u.style.display="none",u.href=p,u.setAttribute("download","report-"+Be()+".json"),document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(u.href),document.body.removeChild(u)}).catch(r=>{R.error("导出失败,原因:"+r)})}const te=l=>{J.push(`/vuln/detail/${l}`)},ae=l=>{w.pageSize=l,D()},le=l=>{w.pageNum=l,D()},ne=()=>{const l=c.agentId,n=c.level;if(l==null||l==""&&n==0){D();return}be(l,n).then(r=>{const o=r.data;V.value=o.list,T.value=o.pageSize,U.value=o.pages,L.value=o.pageNum,N.value=o.total}).catch(()=>{V.value=[],T.value=0,U.value=0,L.value=0,N.value=0})},oe=()=>{c.agentId="",c.level=0};function se(l,n){he(l,n).then(()=>{let r=A.value.find(o=>o.statusId===n);R.success("漏洞状态已切换成"+r.statusName)}).catch(r=>{xe(r)})}return D(),G(),(l,n)=>{const r=s("el-input"),o=s("el-form-item"),p=s("el-option"),u=s("el-select"),x=s("el-button"),re=s("el-form"),O=s("el-card"),S=s("el-tooltip"),b=s("el-table-column"),ue=s("el-link"),_=s("el-col"),I=s("el-text"),z=s("el-row"),de=s("More"),ie=s("el-icon"),ce=s("el-dropdown-item"),pe=s("el-dropdown-menu"),_e=s("el-dropdown"),fe=s("el-table"),me=s("el-pagination"),P=Re("loading");return d(),q("div",je,[j((d(),g(O,{shadow:"never",class:"search-wrapper"},{default:t(()=>[h("div",null,[e(re,{ref:"searchFormRef",inline:!0,model:c},{default:t(()=>[e(o,{prop:"url",label:"应用ID"},{default:t(()=>[e(r,{modelValue:c.agentId,"onUpdate:modelValue":n[0]||(n[0]=a=>c.agentId=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(o,{prop:"level",label:"漏洞等级"},{default:t(()=>[e(u,{modelValue:c.level,"onUpdate:modelValue":n[1]||(n[1]=a=>c.level=a),style:{width:"80px"}},{default:t(()=>[(d(!0),q($,null,F(m(Le),a=>(d(),g(p,{label:m(W)(a.value),value:a.value,key:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(o,null,{default:t(()=>[e(x,{type:"primary",icon:m(ye),onClick:ne},{default:t(()=>[i("查询")]),_:1},8,["icon"]),e(x,{icon:m(Ce),onClick:oe},{default:t(()=>[i("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[P,C.value]]),j((d(),g(O,{shadow:"never"},{default:t(()=>[h("div",$e,[h("div",null,[e(x,{type:"danger",icon:m(De),onClick:Y},{default:t(()=>[i("批量删除")]),_:1},8,["icon"])]),h("div",null,[e(S,{content:"导出报告"},{default:t(()=>[e(x,{type:"primary",icon:m(ke),circle:"",onClick:ee},null,8,["icon"])]),_:1}),e(S,{content:"刷新当前页"},{default:t(()=>[e(x,{type:"primary",icon:m(Se),circle:"",onClick:D},null,8,["icon"])]),_:1})])]),h("div",Fe,[e(fe,{ref:"multipleTableRef",data:V.value,style:{width:"100%"},onSelectionChange:X},{default:t(()=>[e(b,{type:"selection",width:"55"}),e(b,{prop:"level",label:"漏洞等级",width:"120",sortable:""},{default:t(a=>[h("span",{class:Te(m(Ue)(a.row.level))},y(m(W)(a.row.level)),3)]),_:1}),e(b,{label:"漏洞概述",align:"left",width:"600"},{default:t(a=>[e(_,null,{default:t(()=>[e(z,{span:5},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(ue,{type:"primary",onClick:v=>te(a.row.id)},{default:t(()=>[i(y(a.row.vulnerableTypeZH),1)]),_:2},1032,["onClick"])]),_:2},1024),e(_,{span:16},{default:t(()=>[e(I,null,{default:t(()=>[i("keypoint")]),_:1})]),_:1})]),_:2},1024),B(a.row.vulnerableType)==1?(d(),g(z,{key:0,span:15},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(S,{content:a.row.uri,placement:"bottom-end"},{default:t(()=>[e(I,{truncated:"",class:"v-descrption"},{default:t(()=>[i(y(a.row.requestMethod)+" "+y(a.row.uri),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024),e(_,{span:16},{default:t(()=>[e(S,{placement:"bottom-end",content:k(a.row.findingData).sign},{default:t(()=>[e(I,{truncated:"",class:"v-descrption"},{default:t(()=>[i(y(k(a.row.findingData).sign),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):B(a.row.vulnerableType)==2?(d(),g(z,{key:1,span:15},{default:t(()=>[e(_,{span:8}),e(_,{span:16},{default:t(()=>[e(S,{placement:"bottom-end",content:k(a.row.findingData).className},{default:t(()=>[e(I,{truncated:"",class:"v-descrption"},{default:t(()=>[i(y(k(a.row.findingData).className),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):B(a.row.vulnerableType)==3?(d(),g(z,{key:2,span:15},{default:t(()=>[e(_,{span:8}),e(_,{span:16},{default:t(()=>[e(S,{placement:"bottom-end",content:k(a.row.findingData).url},{default:t(()=>[e(I,{truncated:"",class:"v-descrption"},{default:t(()=>[i(y(k(a.row.findingData).url),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):H("",!0)]),_:2},1024)]),_:1}),e(b,{label:"服务器名",prop:"agent.hostname",sortable:""}),e(b,{label:"最近上报时间",prop:"lastTimestamp",sortable:""}),e(b,{width:"160",label:"状态",prop:"status.statusName",sortable:""},{default:t(a=>[a?(d(),g(u,{key:0,modelValue:a.row.status.statusId,"onUpdate:modelValue":v=>a.row.status.statusId=v,onChange:v=>se(a.row.id,a.row.status.statusId)},{default:t(()=>[(d(!0),q($,null,F(A.value,v=>(d(),g(p,{label:v.statusName,value:v.statusId,key:v.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):H("",!0)]),_:1}),e(b,{label:"选项",prop:""},{default:t(a=>[e(_e,null,{dropdown:t(()=>[e(pe,null,{default:t(()=>[e(ce,{onClick:v=>M(a.row.id)},{default:t(()=>[i("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[e(ie,{style:{cursor:"pointer"}},{default:t(()=>[e(de)]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])]),h("div",He,[e(me,{"current-page":w.pageNum,"onUpdate:currentPage":n[2]||(n[2]=a=>w.pageNum=a),"page-size":w.pageSize,"onUpdate:pageSize":n[3]||(n[3]=a=>w.pageSize=a),"page-sizes":[10,20,50,100],small:!1,disabled:K.value,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:N.value,onSizeChange:ae,onCurrentChange:le},null,8,["current-page","page-size","disabled","total"])])]),_:1})),[[P,C.value]])])}}});const tt=Ee(We,[["__scopeId","data-v-28bc8ace"]]);export{tt as default};
