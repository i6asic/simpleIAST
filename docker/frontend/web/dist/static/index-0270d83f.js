import{s as se,t as re,u as de}from"./index-110ed2a8.js";import{x as ue,r as ie,z as ce,C as pe,A as _e,B as fe,E as L}from"./element-12e92669.js";import{p as me,r as f,aE as ge,Z as ve,ai as o,aq as we,q as m,t as M,P,M as D,O as t,v,U as e,F as he,a8 as be,u as p,S as u,I as ye,T as w,R as Ce}from"./vue-956193f0.js";import{v as ke,a as De,g as j,b as xe}from"./level-f8ca1491.js";import{e as ze,f as Se,_ as Ve}from"./index-e50c813d.js";import{p as Ne,a as Re,b as Te}from"./level.css_vue_type_style_index_0_src_true_lang-fb9792d3.js";import"./vxe-c7146e14.js";const Be={class:"app-container"},Ie={class:"toolbar-wrapper"},Le={class:"table-wrapper"},Ue={class:"demo-pagination-block"},qe=me({__name:"index",setup(Ae){const h=f(!1),O=ge(),F=f(!1),x=f(),R=f(10),T=f(1),B=f(0),V=f(0),g={pageSize:20,pageNum:1},i=ve({agentId:"",level:0}),b=()=>{h.value=!0,se(g).then(n=>{const{pageSize:l,pageNum:d,total:s,pages:_,list:r}=n.data;x.value=r,R.value=l,B.value=_,T.value=d,V.value=s}).catch(()=>{x.value=[]}).finally(()=>{h.value=!1})};b();function y(n){const l=JSON.parse(n),d=l.vulnerableType;if(d=="hard_code")return Ne(l)[0];if(d=="weak_password_in_sql")return Re(l)[0];{const s=l.flowData,_=Te(s),r=_.length;return _[r-1]}}function I(n){return n=="hard_code"?2:n=="weak_password_in_sql"?3:1}const U=f();function $(n){U.value=n}function H(){const n=[];for(const l of U.value)n.push(l.id);fe.confirm("确定删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{L({type:"success",message:"删除成功"}),h.value=!0,re(n.join(",")).then(()=>{b()}).finally(()=>{h.value=!1})}).catch(()=>{L({type:"info",message:"删除取消"})})}function Z(){const n="/api/v1/report/export",l=ze();Se({method:"get",baseURL:n,data:{},headers:{Authorization:l?`Bearer ${l}`:void 0},responseType:"blob"}).then(d=>{const s=d.data;if(!s)return;const _=window.URL.createObjectURL(new Blob([s])),r=document.createElement("a");r.style.display="none",r.href=_,r.setAttribute("download","report-"+xe()+".json"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(r.href),document.body.removeChild(r)}).catch(d=>{L.error("导出失败,原因:"+d)})}const J=n=>{O.push(`/vuln/detail/${n}`)},Q=n=>{g.pageSize=n,b()},W=n=>{g.pageNum=n,b()},G=()=>{const n=i.agentId,l=i.level;if(n==null||n==""&&l==0){b();return}de(n,l).then(d=>{const s=d.data;x.value=s.list,R.value=s.pageSize,B.value=s.pages,T.value=s.pageNum,V.value=s.total}).catch(()=>{x.value=[],R.value=0,B.value=0,T.value=0,V.value=0})},K=()=>{i.agentId="",i.level=0};return(n,l)=>{const d=o("el-input"),s=o("el-form-item"),_=o("el-option"),r=o("el-select"),z=o("el-button"),X=o("el-form"),q=o("el-card"),C=o("el-tooltip"),k=o("el-table-column"),Y=o("el-link"),c=o("el-col"),S=o("el-text"),N=o("el-row"),ee=o("More"),te=o("el-icon"),A=o("el-dropdown-item"),ae=o("el-dropdown-menu"),ne=o("el-dropdown"),le=o("el-table"),oe=o("el-pagination"),E=we("loading");return m(),M("div",Be,[P((m(),D(q,{shadow:"never",class:"search-wrapper"},{default:t(()=>[v("div",null,[e(X,{ref:"searchFormRef",inline:!0,model:i},{default:t(()=>[e(s,{prop:"url",label:"Agent id"},{default:t(()=>[e(d,{modelValue:i.agentId,"onUpdate:modelValue":l[0]||(l[0]=a=>i.agentId=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,{prop:"level",label:"漏洞等级"},{default:t(()=>[e(r,{modelValue:i.level,"onUpdate:modelValue":l[1]||(l[1]=a=>i.level=a),style:{width:"80px"}},{default:t(()=>[(m(!0),M(he,null,be(p(ke),a=>(m(),D(_,{label:p(j)(a.value),value:a.value,key:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e(z,{type:"primary",icon:p(ue),onClick:G},{default:t(()=>[u("查询")]),_:1},8,["icon"]),e(z,{icon:p(ie),onClick:K},{default:t(()=>[u("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[E,h.value]]),P((m(),D(q,{shadow:"never"},{default:t(()=>[v("div",Ie,[v("div",null,[e(z,{type:"danger",icon:p(ce),onClick:H},{default:t(()=>[u("批量删除")]),_:1},8,["icon"])]),v("div",null,[e(C,{content:"导出报告"},{default:t(()=>[e(z,{type:"primary",icon:p(pe),circle:"",onClick:Z},null,8,["icon"])]),_:1}),e(C,{content:"刷新当前页"},{default:t(()=>[e(z,{type:"primary",icon:p(_e),circle:"",onClick:b},null,8,["icon"])]),_:1})])]),v("div",Le,[e(le,{ref:"multipleTableRef",data:x.value,style:{width:"100%"},onSelectionChange:$},{default:t(()=>[e(k,{type:"selection",width:"55"}),e(k,{prop:"level",label:"漏洞等级",width:"120",sortable:""},{default:t(a=>[v("span",{class:ye(p(De)(a.row.level))},w(p(j)(a.row.level)),3)]),_:1}),e(k,{label:"漏洞概述",align:"left",width:"600"},{default:t(a=>[e(c,null,{default:t(()=>[e(N,{span:5},{default:t(()=>[e(c,{span:8},{default:t(()=>[e(Y,{type:"primary",onClick:Ee=>J(a.row.id)},{default:t(()=>[u(w(a.row.vulnerableTypeZH),1)]),_:2},1032,["onClick"])]),_:2},1024),e(c,{span:16},{default:t(()=>[e(S,null,{default:t(()=>[u("keypoint")]),_:1})]),_:1})]),_:2},1024),I(a.row.vulnerableType)==1?(m(),D(N,{key:0,span:15},{default:t(()=>[e(c,{span:8},{default:t(()=>[e(C,{content:a.row.uri,placement:"bottom-end"},{default:t(()=>[e(S,{truncated:"",class:"v-descrption"},{default:t(()=>[u(w(a.row.requestMethod)+" "+w(a.row.uri),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024),e(c,{span:16},{default:t(()=>[e(C,{placement:"bottom-end",content:y(a.row.findingData).sign},{default:t(()=>[e(S,{truncated:"",class:"v-descrption"},{default:t(()=>[u(w(y(a.row.findingData).sign),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):I(a.row.vulnerableType)==2?(m(),D(N,{key:1,span:15},{default:t(()=>[e(c,{span:8}),e(c,{span:16},{default:t(()=>[e(C,{placement:"bottom-end",content:y(a.row.findingData).className},{default:t(()=>[e(S,{truncated:"",class:"v-descrption"},{default:t(()=>[u(w(y(a.row.findingData).className),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):I(a.row.vulnerableType)==3?(m(),D(N,{key:2,span:15},{default:t(()=>[e(c,{span:8}),e(c,{span:16},{default:t(()=>[e(C,{placement:"bottom-end",content:y(a.row.findingData).url},{default:t(()=>[e(S,{truncated:"",class:"v-descrption"},{default:t(()=>[u(w(y(a.row.findingData).url),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):Ce("",!0)]),_:2},1024)]),_:1}),e(k,{label:"Agent",prop:"agent.hostName",sortable:""}),e(k,{label:"上报时间",prop:"timestamp",sortable:""}),e(k,{label:"选项",prop:""},{default:t(a=>[e(ne,null,{dropdown:t(()=>[e(ae,null,{default:t(()=>[e(A,null,{default:t(()=>[u("未定")]),_:1}),e(A,{divided:""},{default:t(()=>[u("删除")]),_:1})]),_:1})]),default:t(()=>[e(te,{style:{cursor:"pointer"}},{default:t(()=>[e(ee)]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),v("div",Ue,[e(oe,{"current-page":g.pageNum,"onUpdate:currentPage":l[2]||(l[2]=a=>g.pageNum=a),"page-size":g.pageSize,"onUpdate:pageSize":l[3]||(l[3]=a=>g.pageSize=a),"page-sizes":[10,20,50,100],small:!1,disabled:F.value,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:V.value,onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","disabled","total"])])]),_:1})),[[E,h.value]])])}}});const Ze=Ve(qe,[["__scopeId","data-v-548ad500"]]);export{Ze as default};
