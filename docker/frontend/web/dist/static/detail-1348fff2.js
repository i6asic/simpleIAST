import{p as se,r as x,aE as ue,ai as c,q as l,t as m,U as t,O as e,I as re,u as N,T as _,R as f,S as p,M as b,F as j,a8 as B,v}from"./vue-956193f0.js";import{b as de,a as ce,c as ie}from"./level-61112490.js";import{p as _e,a as pe,b as ve}from"./level.css_vue_type_style_index_0_src_true_lang-fb9792d3.js";import{q as fe,s as me,t as he}from"./index-3d9e2404.js";import{C as be,E as R,D as ye}from"./element-0afb0e99.js";import{e as ge,f as ke}from"./index-3236e402.js";import"./vxe-78a23074.js";function F(V){const r=Object.entries(V).sort(([o],[h])=>o==="host"||o==="referer"?-1:h==="host"||h==="referer"?1:o.localeCompare(h));let k="";return r.forEach(([o,h])=>{o=o.replace(/(?:^|-)([a-z])/g,T=>T.toUpperCase()),k=k+o+": "+h+`\r
`}),k}function we(V,r,k,o,h){let T=F(k);r=r.toUpperCase();let C=`${r} ${V} ${h}\r
`;return C+=T,o!=null&&(C+=`\r
${atob(o)}`),C}function Te(V,r,k){let o=F(k);return`${V} ${r}\r
${o}`}const xe={key:0},Ve={key:1},Ce={key:2},Re={key:0},qe=v("strong",null,"所属应用:",-1),Le={key:0},Se=v("strong",null,"首次发现时间:",-1),Ue={key:0},De=v("strong",null,"最新发现时间:",-1),Ne={class:"custom-label"},$e={key:0},He={class:"custom-parent-label"},Ie=v("hr",null,null,-1),Ee={class:"parent-node-sign"},Oe={class:"left-content"},Pe={class:"right-content"},je={key:1},Be={style:{display:"inline-block","font-weight":"bold",width:"80px","text-align":"right"}},Fe={style:{display:"inline-block","background-color":"#dedfe080",width:"100%","padding-left":"10px","border-radius":"5px"}},Me={key:2},ze={class:"http-container"},Ae={class:"http-left-pane"},Je=v("h3",null,"HTTP请求",-1),Qe={class:"http-right-pane"},We=v("h3",null,"HTTP响应",-1),at=se({__name:"detail",setup(V){const r=x(),k=ue(),o=x(),h=x(),T=x(),C=x("first"),n=x(),S=x(),M=()=>new Promise((a,s)=>{me(k.currentRoute.value.params.id).then(u=>{n.value=u.data,a(u.data)}).catch(u=>{s(u)})});function z(){navigator.clipboard.writeText(h.value).then(()=>{R.success("文本已成功复制到剪贴板")}).catch(a=>{R.error("复制到剪贴板失败: "+a.message)})}function A(){navigator.clipboard.writeText(T.value).then(()=>{R.success("文本已成功复制到剪贴板")}).catch(a=>{R.error("复制到剪贴板失败: "+a.message)})}function J(){return n.value}function Q(){he().then(a=>{S.value=a.data})}async function W(){try{await M(),Z(),Q()}catch(a){console.error("获取数据失败:",a)}}function Z(){const a=J(),s=JSON.parse(a.findingData);let u=[];const d=s.vulnerableType;if(d=="hard_code")r.value=2,u=_e(s);else if(d=="weak_password_in_sql")r.value=3,u=pe(s),$(a);else{r.value=1;const y=s.flowData;u=ve(y),$(a)}o.value=u}function $(a){h.value=we(a.url,a.requestMethod,a.requestHeader,a.requestBody,a.protocol),T.value=Te(a.protocol,a.statusCode,a.responseHeader)}function G(a){let s=n.value.id;fe(s,a).then(u=>{let d=S.value.find(y=>y.statusId===a);R.success("漏洞状态已切换成"+d.statusName)}).catch(u=>{ye(u)})}function K(){const a=`/api/v1/report/exportOne?reportId=${n.value.id}`,s=ge();ke({method:"get",baseURL:a,data:{},headers:{Authorization:s?`Bearer ${s}`:void 0},responseType:"blob"}).then(u=>{const d=u.data;if(!d)return;const y=window.URL.createObjectURL(new Blob([d])),w=document.createElement("a");w.style.display="none",w.href=y,w.setAttribute("download","report-"+ie()+".json"),document.body.appendChild(w),w.click(),window.URL.revokeObjectURL(w.href),document.body.removeChild(w)}).catch(u=>{R.error("导出失败,原因:"+u)})}return W(),(a,s)=>{const u=c("el-card"),d=c("el-text"),y=c("el-col"),w=c("el-option"),X=c("el-select"),U=c("el-button"),D=c("el-tooltip"),L=c("el-row"),Y=c("el-collapse-item"),ee=c("el-collapse"),te=c("el-tree"),ae=c("el-header"),q=c("el-table-column"),H=c("el-table"),I=c("el-main"),E=c("el-container"),O=c("el-tab-pane"),P=c("el-input"),le=c("el-tabs");return l(),m("div",null,[t(u,{shadow:"hover",class:"report-card"},{default:e(()=>[n.value?(l(),m("h3",xe,[n.value?(l(),m("span",{key:0,class:re(N(de)(n.value.level)),style:{"margin-right":"10px"}},_(N(ce)(n.value.level)),3)):f("",!0),r.value==1||r.value==3?(l(),m("span",Ve,_(n.value.url),1)):r.value==2?(l(),m("span",Ce,_(o.value[0].sourceFile),1)):f("",!0),p(" 发现 "+_(n.value.vulnerableTypeZH),1)])):f("",!0)]),_:1}),t(u,{class:"report-card",shadow:"hover"},{default:e(()=>[t(L,{gutter:10},{default:e(()=>[t(y,{span:6},{default:e(()=>[n.value?(l(),m("div",Re,[qe,n.value.agent?(l(),b(d,{key:0},{default:e(()=>[p(_(n.value.agent.hostname),1)]),_:1})):(l(),b(d,{key:1},{default:e(()=>[p("未知")]),_:1}))])):f("",!0)]),_:1}),t(y,{span:6},{default:e(()=>[n.value?(l(),m("div",Le,[Se,n.value.firstTimestamp?(l(),b(d,{key:0},{default:e(()=>[p(_(n.value.firstTimestamp),1)]),_:1})):f("",!0)])):f("",!0)]),_:1}),t(y,{span:6},{default:e(()=>[n.value?(l(),m("div",Ue,[De,n.value.lastTimestamp?(l(),b(d,{key:0},{default:e(()=>[p(_(n.value.lastTimestamp),1)]),_:1})):f("",!0)])):f("",!0)]),_:1}),t(y,{span:6},{default:e(()=>[t(L,{gutter:10},{default:e(()=>[t(y,{span:8},{default:e(()=>[n.value?(l(),b(X,{key:0,modelValue:n.value.status.statusId,"onUpdate:modelValue":s[0]||(s[0]=i=>n.value.status.statusId=i),onChange:G},{default:e(()=>[(l(!0),m(j,null,B(S.value,i=>(l(),b(w,{label:i.statusName,value:i.statusId,key:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):f("",!0)]),_:1}),t(y,{span:6},{default:e(()=>[t(D,{content:"导出漏洞"},{default:e(()=>[t(U,{type:"primary",icon:N(be),circle:"",onClick:K},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(u,{class:"report-details",shadow:"hover"},{default:e(()=>[t(le,{modelValue:C.value,"onUpdate:modelValue":s[3]||(s[3]=i=>C.value=i)},{default:e(()=>[t(O,{label:"漏洞细节",name:"first"},{default:e(()=>[r.value==1?(l(),b(te,{key:0,indent:16,data:o.value,"node-key":"id"},{default:e(({node:i,data:g})=>[v("div",Ne,[i.level==1?(l(),m("div",$e,[v("div",He,_(g.label),1),Ie,v("div",Ee,[v("div",Oe,_(g.sign),1),v("div",Pe,[t(L,{class:"w-600px mb-2"},{default:e(()=>[t(D,{content:g.taint,placement:"top-end"},{default:e(()=>[t(d,{style:{color:"red"},truncated:""},{default:e(()=>[p(_(g.taint),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)])])])):g.label!="调用栈："?(l(),m("div",je,[v("div",Be,_(g.label),1),v("div",Fe,[t(L,{class:"w-1200px mb-2"},{default:e(()=>[t(D,{content:g.value,placement:"top-end"},{default:e(()=>[t(d,{truncated:""},{default:e(()=>[p(_(g.value),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)])])):(l(),m("div",Me,[t(ee,null,{default:e(()=>[t(Y,{title:"调用栈"},{default:e(()=>[g.value?(l(!0),m(j,{key:0},B(g.value,(oe,ne)=>(l(),m("div",{key:ne},[t(d,{truncated:"",style:{"line-height":"30px","padding-left":"10px","background-color":"rgba(222, 223, 224, 0.5)"}},{default:e(()=>[p(_(oe),1)]),_:2},1024)]))),128)):f("",!0)]),_:2},1024)]),_:2},1024)]))])]),_:1},8,["data"])):r.value==2?(l(),b(E,{key:1},{default:e(()=>[o.value?(l(),b(ae,{key:0},{default:e(()=>[p(" 硬编码漏洞存在于 "),t(d,{tag:"b"},{default:e(()=>[p(_(o.value[0].sourceFile),1)]),_:1}),p(" 文件中, 类路径： "),t(d,{tag:"b"},{default:e(()=>[p(_(o.value[0].className),1)]),_:1})]),_:1})):f("",!0),t(I,null,{default:e(()=>[o.value?(l(),b(H,{key:0,data:o.value,style:{width:"100%"}},{default:e(()=>[t(q,{prop:"parameterName",label:"参数名"}),t(q,{label:"参数值"},{default:e(i=>[t(d,null,{default:e(()=>[p(_(i.row.parameterValue),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])):f("",!0)]),_:1})]),_:1})):r.value==3?(l(),b(E,{key:2},{default:e(()=>[t(I,null,{default:e(()=>[o.value?(l(),b(H,{key:0,data:o.value,style:{width:"100%"}},{default:e(()=>[t(q,{prop:"url",label:"数据库连接地址"}),t(q,{prop:"user",label:"用户名"}),t(q,{prop:"password",label:"密码"},{default:e(i=>[t(d,null,{default:e(()=>[p(_(i.row.password),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])):f("",!0)]),_:1})]),_:1})):f("",!0)]),_:1}),r.value==1||r.value==3?(l(),b(O,{key:0,label:"HTTP请求信息",name:"second"},{default:e(()=>[v("div",ze,[v("div",Ae,[Je,t(P,{type:"textarea",modelValue:h.value,"onUpdate:modelValue":s[1]||(s[1]=i=>h.value=i)},null,8,["modelValue"]),t(U,{class:"http-copy-button",onClick:z},{default:e(()=>[p("复制")]),_:1})]),v("div",Qe,[We,t(P,{type:"textarea",modelValue:T.value,"onUpdate:modelValue":s[2]||(s[2]=i=>T.value=i)},null,8,["modelValue"]),t(U,{class:"http-copy-button",onClick:A},{default:e(()=>[p("复制")]),_:1})])])]),_:1})):f("",!0)]),_:1},8,["modelValue"])]),_:1})])}}});export{at as default};
